# å¹³è¡¡äºŒå‰æ ‘

```bash
# å¹³è¡¡
- ä¸€ä¸ªäºŒå‰æ ‘ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹çš„rightå’Œleftï¼Œé«˜åº¦å·®è¶…è¿‡1ï¼Œåˆ™æ­¤èŠ‚ç‚¹å¤±è¡¡ï¼Œéœ€è¦æ—‹è½¬
- ä¸€ä¸ªäºŒå‰æ ‘ï¼Œåœ¨å¢åŠ å’Œåˆ é™¤æ—¶ï¼Œå°±ä¼šå¯èƒ½å¯¼è‡´å¤±è¡¡
```

![image-20231112093611479](https://erick-typora-image.oss-cn-shanghai.aliyuncs.com/img/image-20231112093611479.png)

## ğŸ˜[110. å¹³è¡¡äºŒå‰æ ‘](https://leetcode.cn/problems/balanced-binary-tree/)

# 2. ALVæ ‘

### 2.1 AVLTreeNode

- AVLæ ‘æ˜¯æœ€æ—©çš„ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æœç´¢æ ‘

```java
class AVLTreeNode {
    int val;
    int height = 1;
    AVLTreeNode left;
    AVLTreeNode right;

    public AVLTreeNode(int val) {
        this.val = val;
    }

    public AVLTreeNode(int val, AVLTreeNode left, AVLTreeNode right) {
        this.val = val;
        this.left = left;
        this.right = right;
    }
}
```

### 2.2 AVLTree

```java
class AVLTree {
  AVLTreeNode root = null;
}
```

## 3. å¸¸è§æ–¹æ³•

### 3.1 height

- heightï¼šåœ¨æ·»åŠ èŠ‚ç‚¹æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨å¯¹ç›¸åº”èŠ‚ç‚¹è¿›è¡Œé«˜åº¦èµ‹å€¼

```java
public int getHeight(AVLTreeNode node) {
    return node == null ? 0 : node.height;
}

public void updateHeight(AVLTreeNode node) {
    node.height = Integer.max(getHeight(node.left), getHeight(node.right)) + 1;
}
```

### 3.2 insert

- ä¿è¯æ¯æ¬¡æ·»åŠ å…ƒç´ åï¼Œéƒ½æ˜¯ä¸€ä¸ªåˆæ³•çš„å¹³è¡¡äºŒå‰æœç´¢æ ‘

![image-20231111130306086](https://erick-typora-image.oss-cn-shanghai.aliyuncs.com/img/image-20231111130306086.png)

```bash
# 1. æ·»åŠ 
- 1.1 æ·»åŠ ï¼š æ‰¾åˆ°è¦insertçš„å…·ä½“å…ƒç´ çš„ä½ç½®è¿›è¡Œæ·»åŠ 
- 1.2 é«˜åº¦ï¼š  æ ¹æ®ä¸Šä¸€æ­¥éª¤ä¸­çš„æ‰¾å¯»çš„è·¯å¾„ï¼Œå¯¹æ¯ä¸ªç»¿è‰²èŠ‚ç‚¹ï¼Œä»åº•åˆ°é¡¶çš„æ›´æ–°é«˜åº¦

# 2. åˆ¤æ–­å¹³è¡¡
- 2.1 åˆ¤æ–­æ˜¯å¦å¹³è¡¡ï¼Œå¹³è¡¡åˆ™ä»€ä¹ˆä¸åšï¼Œä¸å¹³è¡¡åˆ™æ ¹æ®å››ç§å¤±è¡¡ï¼Œè¿›è¡Œå¯¹åº”æ—‹è½¬
- 2.2.æ—‹è½¬æ—¶å€™ï¼šå¯¹å¯¹åº”çš„ä¸‹æ½œå’Œä¸Šä½èŠ‚ç‚¹è¿›è¡Œé«˜åº¦æ›´æ–°
# æ¯æ¬¡æ·»åŠ å…ƒç´ éƒ½ä¼šè¿›è¡Œåˆ¤æ–­å¹³è¡¡ï¼Œå› æ­¤æ¯æ¬¡åªéœ€è¦å¯¹rootèŠ‚ç‚¹è¿›è¡Œåˆ¤æ–­å¹³è¡¡ï¼Œä¸éœ€è¦æ•´ä½“æ‰«ææ•´æ£µæ ‘
```

```java
public void insert(int val) {
      if (root == null) {
          root = new AVLTreeNode(val);
          return;
      }

      LinkedList<AVLTreeNode> path = new LinkedList<>(); // è¦æ›´æ–°çš„èŠ‚ç‚¹é«˜åº¦
      AVLTreeNode cur = root;
      AVLTreeNode prev = null;

      while (cur != null) {
          path.push(cur);
          prev = cur;
          if (val < cur.val) {
              cur = cur.left;
          } else if (val > cur.val) {
              cur = cur.right;
          } else {
              System.out.println("equals, ignore");
          }
      }

      /*å·¦æˆ–å³*/
      AVLTreeNode inserted = new AVLTreeNode(val);
      if (prev.val > val) {
          prev.left = inserted;
      } else {
          prev.right = inserted;
      }

      /*æŒ‰ç…§æœç´¢è·¯å¾„ï¼Œæ›´æ–°æ¯ä¸ªèŠ‚ç‚¹çš„height*/
      while (!path.isEmpty()) {
          updateHeight(path.pop());
      }
      // é‡æ–°å¹³è¡¡
      
  }
```

### 3.3 remove

- åˆ é™¤åŒç†
- ä»£ç å¾…æäº¤

### 3.4 bf

- balance factor: ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå·¦å­æ ‘é«˜åº¦-å³å­æ ‘é«˜åº¦
- å¹³è¡¡ï¼š 0ï¼Œ1ï¼Œ-1

```java
public int balanceFactor(AVLTreeNode node) {
    AVLTreeNode left = node.left;
    AVLTreeNode right = node.right;
    return getHeight(left) - getHeight(right);
}
```

## 4. å››ç§å¤±è¡¡

- Lå’ŒRè¡¨ç¤ºè°é«˜ï¼Œé¡ºåºè¡¨ç¤ºå¤±è¡¡èŠ‚ç‚¹å’Œå­æ ‘
- å¹³è¡¡å› å­ï¼šä¸€ä¸ªèŠ‚ç‚¹ï¼Œå·¦å­æ ‘é«˜åº¦-å³å­æ ‘é«˜åº¦ï¼ŒBF

### 4.1 LL

- å¤±è¡¡èŠ‚ç‚¹(5)çš„ bf >1ï¼Œå³å·¦è¾¹æ›´é«˜
- å¤±è¡¡èŠ‚ç‚¹çš„å·¦å­æ ‘(3)çš„bf >=0ï¼Œå³å·¦å­©å­ä¹Ÿæ˜¯å·¦è¾¹é«˜æˆ–è€…ç­‰é«˜

```Â bash
# å‘å³æ—‹è½¬ä¸€æ¬¡
- 1. å‘å³æ—‹è½¬
- 2. å¤±è¡¡èŠ‚ç‚¹çš„å·¦å­©å­3çš„å³å­æ ‘4ï¼Œå˜æˆäº†ä¸‹æ½œèŠ‚ç‚¹5çš„å·¦å­æ ‘

# é«˜åº¦
- ç°è‰²èŠ‚ç‚¹çš„éƒ½æ²¡å˜ï¼Œæ¢çˆ¹èŠ‚ç‚¹4ä¹Ÿä¸å˜
- å…ˆæ›´æ–°ä¸‹æ½œçš„èŠ‚ç‚¹é«˜åº¦
- å†æ›´æ–°ä¸Šä½èŠ‚ç‚¹é«˜åº¦
```

![image-20231109144447006](https://erick-typora-image.oss-cn-shanghai.aliyuncs.com/img/image-20231109144447006.png)

### 4.2 LR

- å¤±è¡¡èŠ‚ç‚¹(6)çš„BF>1ï¼Œå³å·¦è¾¹æ›´é«˜
- å¤±è¡¡èŠ‚ç‚¹çš„å·¦å­æ ‘(2)çš„BF<0, å³å·¦å­æ ‘çš„æƒ…å†µæ˜¯ï¼šå³è¾¹æ›´é«˜

```bash
# å¤±è¡¡èŠ‚ç‚¹å·¦å­æ ‘å‘å·¦æ—‹è½¬1æ¬¡
- å˜æˆ4.1çš„æƒ…å†µ
# å‘å³è¾¹æ—‹è½¬ä¸€æ¬¡
```

![image-20231109150223352](https://erick-typora-image.oss-cn-shanghai.aliyuncs.com/img/image-20231109150223352.png)

### 4.3 RL

- å¤±è¡¡èŠ‚ç‚¹(2)çš„BF < -1, å³å³è¾¹æ›´é«˜
- å¤±è¡¡èŠ‚ç‚¹çš„å³å­©å­(6)çš„BF>0, å³å³å­©å­è¿™è¾¹ï¼šå·¦è¾¹æ›´é«˜

![image-20231109151053257](https://erick-typora-image.oss-cn-shanghai.aliyuncs.com/img/image-20231109151053257.png)

### 4.4 RR

- å¤±è¡¡èŠ‚ç‚¹(2)çš„BF<-1ï¼Œå³å³è¾¹æ›´é«˜
- å¤±è¡¡èŠ‚ç‚¹çš„å³å­©å­(6)çš„BF<=0ï¼Œå³å³å­©å­è¿™è¾¹ï¼Œå³è¾¹æ›´é«˜æˆ–è€…ç­‰é«˜

```bash
# å‘å·¦æ—‹ä¸€æ¬¡
- 1. å‘å·¦æ—‹è½¬
- 2. å¤±è¡¡èŠ‚ç‚¹çš„å³å­æ ‘çš„å·¦èŠ‚ç‚¹3ï¼Œå˜ä¸ºä¸‹æ½œèŠ‚ç‚¹2çš„å³å­æ ‘

# é«˜åº¦
# é«˜åº¦
- ç°è‰²èŠ‚ç‚¹çš„éƒ½æ²¡å˜ï¼Œæ¢çˆ¹èŠ‚ç‚¹3ä¹Ÿä¸å˜
- å…ˆæ›´æ–°ä¸‹æ½œçš„èŠ‚ç‚¹é«˜åº¦
- å†æ›´æ–°ä¸Šä½èŠ‚ç‚¹é«˜åº¦
```

![image-20231109144322946](https://erick-typora-image.oss-cn-shanghai.aliyuncs.com/img/image-20231109144322946.png)

```java
/*å³æ—‹å¤±è¡¡èŠ‚ç‚¹*/
  public AVLTreeNode rightRotate(AVLTreeNode node) {
      AVLTreeNode up = node.left;
      AVLTreeNode down = node;
      AVLTreeNode child = up.right;

      down.right = child; // æ¢çˆ¹
      up.right = down;    // ä¸Šä½
      updateHeight(down); // æ›´æ–°é«˜åº¦é¡ºåºä¸èƒ½å˜
      updateHeight(up);
      return up;
  }

  /*å·¦æ—‹å¤±è¡¡èŠ‚ç‚¹*/
  public AVLTreeNode leftRotate(AVLTreeNode node) {
      AVLTreeNode up = node.right;
      AVLTreeNode down = node;
      AVLTreeNode child = up.left;

      down.right = child; // æ¢çˆ¹
      up.left = down;      // ä¸Šä½
      updateHeight(down);
      updateHeight(up);
      return up;
  }

  /*å…ˆå·¦æ—‹ï¼Œåå³æ—‹*/
  public AVLTreeNode leftRightRotate(AVLTreeNode node) {
      // 1. å¤±è¡¡èŠ‚ç‚¹çš„å·¦å­æ ‘å·¦æ—‹è½¬
      node.left = leftRotate(node.left);
      // 2. æ ¹èŠ‚ç‚¹æœ‰æ—‹è½¬
      return rightRotate(node);
  }

  /*å…ˆå³æ—‹ï¼Œå†å·¦è½¬*/
  public AVLTreeNode rightLeftRotate(AVLTreeNode node) {
      node.right = rightRotate(node.right);
      return leftRotate(node);
  }

  /*å¹³è¡¡æŸä¸ªèŠ‚ç‚¹*/
  public AVLTreeNode balance(AVLTreeNode node) {
      if (node == null) {
          return null;
      }

      int balanceFactor = balanceFactor(node);
      /*ä¸å¹³è¡¡çš„å››ç§æƒ…å†µ*/
      if (balanceFactor > 1 && balanceFactor(node.left) >= 0) { //LL
          return rightRotate(node);
      } else if (balanceFactor > 1 && balanceFactor(node.left) < 0) { // LR
          return leftRightRotate(node);
      } else if (balanceFactor < -1 && balanceFactor(node.right) > 0) { //RL
          return rightLeftRotate(node);
      } else if (balanceFactor < -1 && balanceFactor(node.right) <= 0) { //RR
          return leftRotate(node);
      }
      return node;
  }
```

# 